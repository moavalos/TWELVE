<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil de Usuario</title>
    <link rel="stylesheet" th:href="@{/css/perfil.css}"/>
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/5.2.0/css/bootstrap.min.css}"/>
</head>
<body>

<div th:insert="fragments/header :: header"></div>

<section class="profile container mt-5">
    <div class="profile-info row">
        <div class="profile-left col-md-8 d-flex">
            <div class="avatar">
                <img th:src="@{/images/user/foto-perfil.jpg}" alt="User Avatar">
            </div>
            <div class="info ms-4">
                <h1 th:text="${usuario.username}">Nombre del Usuario</h1>
                <p class="mt-3" th:text="${usuario.descripcion}">Descripción del perfil</p>
                <p>Nombre: <span th:text="${usuario.nombre}">@Nombre</span></p>
                <p>Ubicación: <span th:text="${usuario.pais}">Ubicación</span></p>

                <p>Ubicación: <span th:text="${usuario.pais.nombre}">Ubicación</span></p>
                <p>Username: <span th:text="${usuario.username}">@username</span></p>

                <div class="follow-button mt-4">
                    <form th:action="@{${seguirODejarUrl}}" method="post" th:if="${!esPerfilPropio}">
                        <button type="submit" class="btn"
                                th:classappend="${estaSiguiendo ? 'btn-danger' : 'btn-primary'}"
                                th:text="${estaSiguiendo ? 'Dejar de Seguir' : 'Seguir'}"></button>
                    </form>
                </div>

            </div>
        </div>
        <div class="stats col-md-4 d-flex justify-content-around">
            <div class="stat-item">
                <p class="stat-title">Películas</p>
                <p class="stat-number" th:text="${cantidadPeliculasVistas}"></p>
            </div>
            <div class="stat-item">
                <p class="stat-title">Vistas este año</p>
                <p class="stat-number" th:text="${cantidadPeliculasVistasEsteAno}"></p>
            </div>
            <div class="stat-item">
                <p class="stat-title">Seguidores</p>
                <p class="stat-number" th:text="${seguidores.size()}"></p>
            </div>
            <div class="stat-item">
                <p class="stat-title">Siguiendo</p>
                <p class="stat-number" th:text="${siguiendo.size()}"></p>
            </div>
        </div>
    </div>

    <nav class="menu mt-5">
        <ul class="nav justify-content-center">
            <li class="nav-item"><a href="#perfil" class="nav-link">Perfil</a></li>
            <li class="nav-item"><a href="#actividad" class="nav-link">Actividad</a></li>
            <li class="nav-item"><a href="#peliculas" class="nav-link">Películas</a></li>
            <li class="nav-item"><a href="#historial" class="nav-link">Historial</a></li>
            <li class="nav-item"><a href="#reseñas" class="nav-link">Reseñas</a></li>
            <li class="nav-item"><a href="#watchlist" class="nav-link">Watchlist</a></li>
            <li class="nav-item"><a href="#listas" class="nav-link">Listas</a></li>
            <li class="nav-item"><a th:href="@{/favoritos}" class="nav-link">Favoritos</a></li>
            <li class="nav-item"><a href="#tags" class="nav-link">Tags</a></li>
            <li class="nav-item"><a href="#amigos" class="nav-link">Amigos</a></li>
            <li class="nav-item"><a href="#invitaciones" class="nav-link">Invitaciones</a></li>
        </ul>
    </nav>
</section>

<section class="content container my-5">
    <!-- pelis favs -->

    <div class="favorite-movies mb-5">
        <h2 class="text-center mb-4">Películas favoritas</h2>

        <div class="d-flex justify-content-center">
            <div th:if="${peliculasFavoritas.isEmpty()}"
                 class="no-favorites-message d-flex align-items-center justify-content-center bg-dark text-white rounded w-100"
                 style="height: 200px;">
                <p class="text-center m-0 fs-5">No agregaste películas favoritas todavía</p>
            </div>

            <div class="movies-grid d-flex justify-content-between w-100" th:unless="${peliculasFavoritas.isEmpty()}">
                <div th:each="pelicula : ${peliculasFavoritas}" class="movie text-center mx-2">

                    <a th:href="@{/detalle-pelicula/{id}(id=${pelicula.id})}" class="no-link">
                        <img th:src="@{'/images/' + ${pelicula.imagen}}" th:alt="${pelicula.nombre}"
                             class="img-fluid rounded mb-2">
                    </a>
                    <p th:text="${pelicula.nombre}" class="fw-bold">Nombre de la película</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Watchlist -->
    <div class="watchlist mb-5">
        <h2 class="text-center">Watchlist</h2>
        <div class="movies-grid d-flex justify-content-between">
            <div class="movie">
                <img th:src="@{/images/parasitos.jpg}" alt="Película 4">
            </div>
            <div class="movie">
                <img th:src="@{/images/interestelar.jpg}" alt="Película 5">
            </div>
            <div class="movie add-more">
                <a href="url/a/la/nueva/pagina.html">Ver todas</a>
            </div>
        </div>
    </div>

    <!-- Actividad reciente -->
    <div class="recent-activity mb-5">
        <h2>Actividad reciente</h2>

        <div class="d-flex justify-content-center">
            <!-- Mensaje de "sin comentarios" -->
            <div th:if="${comentariosRecientes.isEmpty()}"
                 class="no-favorites-message d-flex align-items-center justify-content-center bg-dark text-white rounded w-100"
                 style="height: 200px;">
                <p class="text-center m-0 fs-5">No hay comentarios que mostrar.</p>
            </div>

            <!-- Lista de comentarios -->
            <div class="w-100" th:unless="${comentariosRecientes.isEmpty()}">
                <div th:each="comentario : ${comentariosRecientes}" class="card mb-3">
                    <div class="card-body">
                        <div class="d-flex align-items-start">
                            <!-- Enlace solo envuelve la foto de la película -->
                            <a th:href="@{/detalle-pelicula/{id}(id=${comentario.getIdMovie()})}">
                                <img th:src="@{'/images/' + ${comentario.imagenPelicula}}" alt="Imagen de la película"
                                     class="rounded me-3" width="100">
                            </a>
                            <div>
                                <h6>
                                    Película:
                                    <span th:text="${comentario.nombrePelicula}">Nombre de la película</span>
                                    <span class="text-success">Puntaje:
                                    <span th:text="${comentario.valoracion}">Valoración</span>/10
                                </span>
                                </h6>
                                <p th:text="${comentario.descripcion}">Descripción del comentario</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<div th:insert="fragments/footer :: footer"></div>

<script th:src="@{/js/perfil.js}"></script>
</body>
</html>